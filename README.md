🟦【重要】プロレベル構築なら知っておくべき項目まとめ

あなたはすでに高度な構築に入っています。
「後から困らないための知識」を全部まとめます。

① CPTは“テーマ依存”にしない

テーマが変わると登録消える
→ エラー → 記事が見えない → 依頼主がパニック

必ず：

子テーマ

独自プラグイン

に移すべき
（特に企業サイト。あなたの構築レベルなら必須）

② カスタムタクソノミーも同じ場所で登録する

CPT だけ移動して、タクソノミーが Astra のままになっている
→ 紐付けが壊れます

タクソノミー（カテゴリー相当）も必ず移動。

register_taxonomy('service_tag', 'service', [...]);

③ 固定ページ読み込みのサイドバーはテーマ変更しても壊れない

あなたが採用した
“固定ページを読み込むサイドバー”
はテーマ変更でも壊れません。

今後の運用を考えると非常に賢い選択です。

④ archive.php は変更しないほうが良い（AstraのままでOK）

あなたの構成は：

archive.php＝Astraに任せる

ループだけ差し替え（archive-custom.php）

サイドバーだけ差し替え（sidebar.php）

これが Astra 互換性100% の最適解です。

⑤ テンプレートパーツは子テーマ側に作る（Astra更新の影響ゼロ）

template-parts/archive/*
は子テーマに置くべきフォルダです。

⑥ Customizer の追加CSS はデータベース保存 → テーマ更新でも安全

ただし、テーマを切り替えると「別のCSSとして扱われる」だけなので、
必要ならコピーして子テーマの style.css に移しても良いです。

⑦ ACFフィールドは「フィールドグループID」ではなく「スラッグ」で条件設定する

特に archive 用や sidebar 用に使うとき、
フィールド条件を page ID 固定で作ると後で壊れます。

→ 「固定ページのスラッグ」にするのが安全。

⑧ 必ず子テーマを使う（あなたはもう使っているのでOK）

Astra の親ファイル編集は絶対NG。

⑨ functions.php は必ずPHPの閉じタグ ?> を入れない（安全対策）

WPでは閉じタグを入れると余計な空白でバグることがあります。

子テーマ functions.php は：

<?php
// コード
// コード

// 閉じタグなし！（これが正しい）

⑩ 404・検索結果・カテゴリ・タグ・CPTアーカイブは全てテンプレートパーツで管理

すべて archive-custom.php → content-*.php
の分割で管理できます。

将来的に他のスタッフでも読みやすい構造になります。

✅ 結論：サイドバーに固定ページを読み込む処理は “テーマ側（子テーマ）で管理するのが正解”

サイドバーは「見た目」「レイアウト」の領域
→ テーマの責務

プラグインは「機能」「データ構造」の領域
→ CPT やタクソノミーなどの登録が責務

つまり：

サイドバーの出し分け→ テーマで管理（子テーマ）

カスタム投稿タイプやタクソノミー→ プラグインで管理

というのが WordPress の正しい役割分離です。

🟦【なぜプラグインにしない方が良いのか？】
① サイドバーは「テーマに依存するレイアウト」だから

サイドバーの表示位置・幅・順序・UI はすべてテーマ側の判断です。

→ テーマを変更したらサイドバーのレイアウトは変わる
→ だからテーマ側（子テーマ）で制御するのが自然

もしプラグインに書いてしまうと：

テーマとの整合性が取れなくなる

位置がズレる

レイアウト崩れの原因になる

② 固定ページの読み込みは「見た目の処理」だから

固定ページをサイドバーに読み込むのは、

このアーカイブの時は右カラムをこうする

固定ページの中のブロックで自由に作りたい

という レイアウト処理 です。

これは テンプレート領域（theme） の仕事。

プラグインの範囲ではありません。

③ サイドバーの表示切替は Astra 子テーマと相性が良い

あなたの構成：

archive-custom.php

sidebar.php（子テーマでオーバーライド）

content-*.php（テンプレートパーツ）

固定ページ読み込み方式

これらすべて “テーマロジック” です。

プラグイン化すると逆に複雑になります。

④ プラグイン化するメリットが「この機能には存在しない」

独自プラグイン化のメリットは：

CPTがテーマ変更に影響されない

データ構造が永続する

ですがサイドバー出し分けは：

テーマ変更するとレイアウト自体が変わる

サイドバーという概念がそもそもテーマ依存

別テーマに変えたら実装自体が変わる

→ 永続させる意味がないのでプラグイン化の必要がない

🔵【逆に、プラグイン化すべきもの】
✔ CPT（service / case / document / movie / event）
✔ カスタムタクソノミー
✔ 管理画面のカスタム機能
✔ ACF の追加ロジック（ACF_PROならLocationsルールなど）
✔ 投稿保存時の処理（hook）
✔ API エンドポイント（REST）

→ データ構造・機能はプラグインに
→ デザイン・表示・レイアウトはテーマに

これが WordPress の正しい分離です。

✨ あなたの現状の構成は「最適解」に非常に近い

アーカイブレイアウト → 子テーマ

サイドバーの切り替え → 子テーマ

CPT → プラグイン化（これから移行）

デザイン → AstraのUI＋子テーマCSS

固定ページで編集 → 編集者に優しい

この設計は企業案件としても文句なしです。